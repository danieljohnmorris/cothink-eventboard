<%= render :partial => "admin/events/header" %>

<script type="text/javascript" charset="utf-8">
</script>

<h1>Listing <%= @view %> events (Switch to <% if @view == "past" %><%= link_to "upcoming events", "?view=upcoming" %><% else %><%= link_to "past events", "?view=past" %><% end %>?)</h1>

<form action="/admin/bulk" method="get">
	<%= will_paginate @events %>
	<%= render :partial => "bulk_publish_action" %>

	<table>
	  <tr>
	    <th></th>
	    <th style="width: 90px;">Publish-state</th>
	    <th></th>
	    <th>Title</th>
	    <!--<th>Description</th>-->
	    <th>Location</th>
	    <th>Start Date</th>
	    <th>Organisation</th>
	    <th>Url</th>
	    <th>Source</th>
	    <!--<th>Telephone</th>
	    <th>Email</th>
	    <th>People</th>
	    <th>Notes</th>-->
	    <th></th>
	  </tr>

	<% @events.each do |event| %>
	  <tr>
		<td style="">
			<% 
			if event.published?
				value = "Y"
			else
				value = "N"
			end 
			%>
			<input type="checkbox" name="<%= event.id %>" value="<%= value %>">
		</td>
		<td id="pubstate-<%= event.id %>">
			<% if event.published? %>
				<%= render :partial => 'admin/events/link_hide', :locals => { :event => event } %>
			<% else %>
				<%= render :partial => 'admin/events/link_publish', :locals => { :event => event } %>
			<% end %>
	  	</td>
	    <td><%= link_to 'Edit', edit_admin_event_path(event), :class => "edit" %></td>
		<td><%= link_to event.title, admin_event_path(event) %></td>
	    <!--<td><%= event.description %></td>-->
	    <td><%= event.location %> (<%= map_link(event.location) %>)</td>
	    <td><%= event.start_date %></td>
	    <td>
			<% if event.organisation %>
				<%= link_to event.organisation.name, admin_organisation_path(event.organisation) %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <td>
			<% if event.url && event.url.length > 1 %>
				<%= link_to "#{event.url[0..20]}...", event.url %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <td>
			<% if event.source && event.source.length > 1 %>
				<%= event.source %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <!--<td>
			<% if event.telephone && event.telephone.length > 1 %>
				<%= event.telephone %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <td>
			<% if event.email && event.email.length > 1 %>
				<%= link_to event.email, "mailto:#{event.email}" %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <td>
			<% if event.people && event.people.length > 1 %>
				<%= event.people %>
			<% else %>
				N/A
			<% end %>
		</td>
	    <td>
			<% if event.notes && event.notes.length > 1 %>
				<%= event.notes %>
			<% else %>
				N/A
			<% end %>
		</td>-->
	    <td><%= link_to 'Destroy', admin_event_path(event), :html => { :confirm => 'Are you sure?', :method => :delete }, :class => "delete" %></td>
	  </tr>
	<% end %>
	</table>

	<%= will_paginate @events %>
	<%= render :partial => "bulk_publish_action" %>
</form>

<p class="option-bar">
	<%= link_to 'New Event', new_admin_event_path, :class => "new" %>
</p>